# Оптимизация развертывания on-site среды Creatio

### Приветствую тебя! Ты, как и я, много времени тратишь на развертывание среды в IIS? Тогда это для тебя :relaxed: Я работаю над скриптом, который позволит сократить времяпрепровождение за подобным занятием. 
____
## Что сможет делать такой скрипт?
Выделено то, что уже реализовано. Остальное будет в ближайшее время реализовано :wink:
+ `Копирует среды.`
+ `Добавляет сайты в IIS.`
+ Восстанавливает базу данных
    + `Восстановление из .bak файла базы данных в MSSQL.`
    + Восстановление из .backup файла базы данных в PostgreSQL.
+ Меняет содержимое файлов в файловой системе
    + `Меняет файл Web.config для среды разработки.`
    + `Меняет файл ConnectionString.config при использовании MSSQL`
    + Меняет файл ConnectionString.config при использовании PostgreSQL.
____
## Конфигурация системы    
Прежде чем запустить у себя, необходимо:    
:arrow_forward: Установить SQL Server Management Studio. Если не установлена, то требуется либо установить SSMS, либо установить через NuGet необходимый пакет по ссылке: https://docs.microsoft.com/ru-ru/sql/relational-databases/server-management-objects-smo/installing-smo?view=sql-server-ver15     
:arrow_forward: В powershell разрешить запуск скриптов. Для этого в Powershell введите:

```powershell
    Set-ExecutionPolicy Unrestricted CurrentUser -Force
```
:arrow_forward:Сам скрипт следует расположить в одной директории с папкой чистой среды.    
:arrow_forward:Запустить скрипт от имени администратора.    
____
## Структура скрипта
Скрипт имеет структуру, которая описана комментариями в скрипте:pencil2:
+ Основные настройки
+ Дополнительные настройки
+ Функции с реализованной логикой
+ Начало работы программы

:speech_balloon: Чтобы всё работало, достаточно менять только основные настройки!
## А как этот ваш скрипт настроить? Сейчас расскажу!
:one: Первым делом идёт путь размещения среды. Это путь, куда при копировании будут попадать все ваши среды
```powershell
    #Путь размещения среды
    $PathEnviroument = "C:\inetpub\wwwroot"
```
:two: Вторым идёт название вашего проекта.  
:heavy_exclamation_mark: **С таким названием должна быть папка вашей чистой среды.** :heavy_exclamation_mark:   
Такое основное название будет и у новоскопированных сред.
```powershell
    #Название папки с проектом
    $NameEnvironment = "NTL"
```
:three: Третьим пунктом идут названия серверов баз данных. Указывает следует в соответствии с указанным комментарием. Сначала название сервера MSSQL, далее PostgreSQL, после Oracle. При отсутствии сервера достаточно не указывать его в массиве :thumbsup:
```powershell
    #Массив имён серверов (MSSQL, PostgreSQL, Oracle)
    $NameServers = @(
        'DESKTOP-K7A1CHF\SQLEXPRESS'
    )
```
:four: Четвёртым пунктом идёт конфигурация сред.   
:heavy_exclamation_mark: **Важно, чтобы было указано минимум 2 среды для корректной работы скрипта**. :heavy_exclamation_mark:    
Если требуется сделать только одну среду, то сделайте `$Envirouments[1] = $false`. В данном случае, здесь указано 3 среды. Вы можете через запятую указать столько сред, сколько хотите получить! :grinning:
### Аргументы двумерного массива с конфигурацией среды
+ 0 аргумент: *Текст приписки среды.*    
Если `$NameEnvironment = "NTL"`, а `$Envirouments[0] = '_dev'`, то получится название папки новой среды: `NTL_dev`
+ 1 аргумент: *Необходимость развёртывания.*    
Если `$Envirouments[1] = $true` и папки с таким названием нет, то это среда будет скопирована, будет создан сайт IIS и настроена база данных. Если такая папка есть, то консоль уведомит вас о наличии такой папки.     
Если `$Envirouments[1] = $false`, то папка не будет копироваться, не будет создаваться сайт IIS и соответствующая база данных
+ 2 аргумент: *Необходимость изменения файла web.config*    
Если `$Envirouments[2] = $true`, то в файле Web.config поменяются параметры, необходимые для разработки в файловой системе.    
Если `$Envirouments[2] = $false`, то файл не изменится.
+ 3 аргумент: *Название сайта в IIS.*    
Можете указать то имя, которое хотите видеть в названии IIS. Не хотите заморачиваться? Тогда просто укажите в аргументе значение `defaultNameIIS`!
+ 4 аргумент: *Номер порта в IIS.*    
По аналогии можете указать нужный порт сайта. Не хотите заморачиваться? Тогда просто укажите в аргументе значение `defaultPortIIS`!    
+ 5 аргумент: *Название базы данных.*    
Можете указать то имя базы, которое хотите видеть в названии. Не хотите заморачиваться? Тогда просто укажите в аргументе значение `defaultNameDB`!    
+ 6 аргумент: *Имя пользователя.*    
Ну вы поняли). Не хотите заморачиваться? Тогда просто укажите в аргументе значение `defaultLoginUSERDB`!    
+ 7 аргумент: *Пароль пользователя.*    
Также можно указать и свой пароль для нового пользователя. Не хотите заморачиваться? Тогда просто укажите в аргументе значение `defaultPasswordUSERDB`!    
+ 8 аргумент: *Номер базы Redis.*    
Следует указать то значение базы Redis, которое хотите увидеть в ConnectionStrings!
```powershell
    #Двумерный массив с конфигурацией среды.
    $Envirouments = @(
        @('_MyDevScript',   $true,   $true,  'defaultNameIIS', 'defaultPortIIS', 'defaultNameDB', 'defaultLoginUSERDB', 'defaultPasswordUSERDB', 5),
        @('_MyTestScript',  $false,  $false,  'defaultNameIIS', 'defaultPortIIS', 'defaultNameDB', 'defaultLoginUSERDB', 'defaultPasswordUSERDB', 6)
        #@('_Test2Script', $true,  $false,  'defaultNameIIS', 'defaultPortIIS', 'defaultNameDB', 'defaultLoginUSERDB', 'defaultPasswordUSERDB', 7)
    )
```
